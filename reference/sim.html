<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate ODE or analytical equation — sim • PKPDsim</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate ODE or analytical equation — sim"><meta name="description" content="Simulates a specified regimen using ODE system or analytical equation"><meta property="og:description" content="Simulates a specified regimen using ODE system or analytical equation"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PKPDsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/PKPDsim.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Documentation</h6></li>
    <li><a class="dropdown-item" href="../articles/model.html">Model</a></li>
    <li><a class="dropdown-item" href="../articles/regimen.html">Regimen</a></li>
    <li><a class="dropdown-item" href="../articles/parameters.html">Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/output.html">Output</a></li>
    <li><a class="dropdown-item" href="../articles/variability.html">Variability</a></li>
    <li><a class="dropdown-item" href="../articles/error.html">Residual error</a></li>
    <li><a class="dropdown-item" href="../articles/covariates.html">Covariates</a></li>
    <li><a class="dropdown-item" href="../articles/export-model.html">Export model</a></li>
    <li><a class="dropdown-item" href="../articles/speed.html">Speed</a></li>
    <li><a class="dropdown-item" href="../articles/estimation-nlmixr.html">Estimation: nlmixr2</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>More Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example-absorption-models.html">Absorption models</a></li>
    <li><a class="dropdown-item" href="../articles/example-pkpd-model.html">PKPD model</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/InsightRX/PKPDsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://ds.insight-rx.com/" aria-label="Home"><span class="fa fa-home"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate ODE or analytical equation</h1>
      <small class="dont-index">Source: <a href="https://github.com/InsightRX/PKPDsim/blob/master/R/sim.R" class="external-link"><code>R/sim.R</code></a></small>
      <div class="d-none name"><code>sim.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Simulates a specified regimen using ODE system or analytical equation</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim</span><span class="op">(</span></span>
<span>  ode <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  analytical <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parameters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parameters_table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mixture_group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  omega <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  omega_type <span class="op">=</span> <span class="st">"exponential"</span>,</span>
<span>  res_var <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  iov_bins <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sequence <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_ind <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  event_table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  regimen <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lagtime <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  covariates_table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  covariates_implementation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  covariate_model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  A_init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  only_obs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  obs_step_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  int_step_size <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  t_max <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  t_obs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  t_tte <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  t_init <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  obs_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  duplicate_t_obs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  extra_t_obs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rtte <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_event_table <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_design <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  output_include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>parameters <span class="op">=</span> <span class="cn">FALSE</span>, covariates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ode">ode<a class="anchor" aria-label="anchor" href="#arg-ode"></a></dt>
<dd><p>function describing the ODE system</p></dd>


<dt id="arg-analytical">analytical<a class="anchor" aria-label="anchor" href="#arg-analytical"></a></dt>
<dd><p>string specifying analytical equation model to use (similar to ADVAN1-5 in NONMEM). If specified, will not use ODEs.</p></dd>


<dt id="arg-parameters">parameters<a class="anchor" aria-label="anchor" href="#arg-parameters"></a></dt>
<dd><p>model parameters</p></dd>


<dt id="arg-parameters-table">parameters_table<a class="anchor" aria-label="anchor" href="#arg-parameters-table"></a></dt>
<dd><p>dataframe of parameters (with parameters as columns) containing parameter estimates for individuals to simulate. Formats accepted: data.frame, data.table, or list of lists.</p></dd>


<dt id="arg-mixture-group">mixture_group<a class="anchor" aria-label="anchor" href="#arg-mixture-group"></a></dt>
<dd><p>mixture group for models containing mixtures. Should be either <code>1</code> or <code>2</code>, since only two groups are currently allowed.</p></dd>


<dt id="arg-omega">omega<a class="anchor" aria-label="anchor" href="#arg-omega"></a></dt>
<dd><p>vector describing the lower-diagonal of the between-subject variability matrix</p></dd>


<dt id="arg-omega-type">omega_type<a class="anchor" aria-label="anchor" href="#arg-omega-type"></a></dt>
<dd><p>exponential or normal, specified as vector</p></dd>


<dt id="arg-res-var">res_var<a class="anchor" aria-label="anchor" href="#arg-res-var"></a></dt>
<dd><p>residual variability. Expected a list with arguments <code>prop</code>, <code>add</code>, and/or <code>exp</code>. NULL by default.</p></dd>


<dt id="arg-iov-bins">iov_bins<a class="anchor" aria-label="anchor" href="#arg-iov-bins"></a></dt>
<dd><p>allow override of the default IOV bins for a model. Specified as a vector of timepoints specifying the bin separators, e.g. <code>iov_bins = c(0, 24, 48, 72, 9999)</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>set seed for reproducible results</p></dd>


<dt id="arg-sequence">sequence<a class="anchor" aria-label="anchor" href="#arg-sequence"></a></dt>
<dd><p>if not NULL specifies the pseudo-random sequence to use, e.g. "halton" or "sobol". See <code>mvrnorm2</code> for more details.</p></dd>


<dt id="arg-n-ind">n_ind<a class="anchor" aria-label="anchor" href="#arg-n-ind"></a></dt>
<dd><p>number of individuals to simulate</p></dd>


<dt id="arg-event-table">event_table<a class="anchor" aria-label="anchor" href="#arg-event-table"></a></dt>
<dd><p>use a previously created <code>design</code> object used for ODE simulation instead of calling create_event_table() to create a new one. Especially useful for repeated calling of sim(), such as in optimizations or optimal design analysis. Also see <code><a href="sim_core.html">sim_core()</a></code> for even faster simulations using precalculated <code>design</code> objects.</p></dd>


<dt id="arg-regimen">regimen<a class="anchor" aria-label="anchor" href="#arg-regimen"></a></dt>
<dd><p>a regimen object created using the regimen() function</p></dd>


<dt id="arg-lagtime">lagtime<a class="anchor" aria-label="anchor" href="#arg-lagtime"></a></dt>
<dd><p>either a value (numeric) or a parameter (character) or NULL.</p></dd>


<dt id="arg-covariates">covariates<a class="anchor" aria-label="anchor" href="#arg-covariates"></a></dt>
<dd><p>list of covariates (for single individual) created using <code><a href="new_covariate.html">new_covariate()</a></code> function</p></dd>


<dt id="arg-covariates-table">covariates_table<a class="anchor" aria-label="anchor" href="#arg-covariates-table"></a></dt>
<dd><p>data.frame (or unnamed list of named lists per individual) with covariate values</p></dd>


<dt id="arg-covariates-implementation">covariates_implementation<a class="anchor" aria-label="anchor" href="#arg-covariates-implementation"></a></dt>
<dd><p>used only for <code>covariates_table</code>, a named list of covariate implementation methods per covariate, e.g. <code>list(WT = "interpolate", BIN = "locf")</code></p></dd>


<dt id="arg-covariate-model">covariate_model<a class="anchor" aria-label="anchor" href="#arg-covariate-model"></a></dt>
<dd><p>R code used to pre-calculate effective parameters for use in ADVAN-style analytical equations. Not used in ODE simulations.</p></dd>


<dt id="arg-a-init">A_init<a class="anchor" aria-label="anchor" href="#arg-a-init"></a></dt>
<dd><p>vector with the initial state of the ODE system</p></dd>


<dt id="arg-only-obs">only_obs<a class="anchor" aria-label="anchor" href="#arg-only-obs"></a></dt>
<dd><p>only return the observations</p></dd>


<dt id="arg-obs-step-size">obs_step_size<a class="anchor" aria-label="anchor" href="#arg-obs-step-size"></a></dt>
<dd><p>the step size between the observations</p></dd>


<dt id="arg-int-step-size">int_step_size<a class="anchor" aria-label="anchor" href="#arg-int-step-size"></a></dt>
<dd><p>the step size for the numerical integrator</p></dd>


<dt id="arg-t-max">t_max<a class="anchor" aria-label="anchor" href="#arg-t-max"></a></dt>
<dd><p>maximum simulation time, if not specified will pick the end of the regimen as maximum</p></dd>


<dt id="arg-t-obs">t_obs<a class="anchor" aria-label="anchor" href="#arg-t-obs"></a></dt>
<dd><p>vector of observation times, only output these values (only used when t_obs==NULL)</p></dd>


<dt id="arg-t-tte">t_tte<a class="anchor" aria-label="anchor" href="#arg-t-tte"></a></dt>
<dd><p>vector of observation times for time-to-event simulation</p></dd>


<dt id="arg-t-init">t_init<a class="anchor" aria-label="anchor" href="#arg-t-init"></a></dt>
<dd><p>initialization time before first dose, default 0.</p></dd>


<dt id="arg-obs-type">obs_type<a class="anchor" aria-label="anchor" href="#arg-obs-type"></a></dt>
<dd><p>vector of observation types. Only valid in combination with equal length vector <code>t_obs</code>.</p></dd>


<dt id="arg-duplicate-t-obs">duplicate_t_obs<a class="anchor" aria-label="anchor" href="#arg-duplicate-t-obs"></a></dt>
<dd><p>allow duplicate t_obs in output? E.g. for optimal design calculations when t_obs = c(0,1,2,2,3). Default is FALSE.</p></dd>


<dt id="arg-extra-t-obs">extra_t_obs<a class="anchor" aria-label="anchor" href="#arg-extra-t-obs"></a></dt>
<dd><p>include extra t_obs in output for bolus doses? This is only activated when <code>t_obs</code> is not specified manually. E.g. for a bolus dose at t=24, if FALSE, PKPDsim will output only the trough, so for bolus doses you might want to switch this setting to TRUE. When set to "auto" (default), it will be TRUE by default, but will switch to FALSE whenever <code>t_obs</code> is specified manually.</p></dd>


<dt id="arg-rtte">rtte<a class="anchor" aria-label="anchor" href="#arg-rtte"></a></dt>
<dd><p>should repeated events be allowed (FALSE by default)</p></dd>


<dt id="arg-checks">checks<a class="anchor" aria-label="anchor" href="#arg-checks"></a></dt>
<dd><p>perform input checks? Default is TRUE. For calculations where sim_ode is invoked many times (e.g. population estimation, optimal design) it makes sense to switch this to FALSE (after confirming the input is correct) to improve speed.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>show more output</p></dd>


<dt id="arg-return-event-table">return_event_table<a class="anchor" aria-label="anchor" href="#arg-return-event-table"></a></dt>
<dd><p>return the event table for the simulation only, does not run the actual simulation. Useful for iterative use of sim().</p></dd>


<dt id="arg-return-design">return_design<a class="anchor" aria-label="anchor" href="#arg-return-design"></a></dt>
<dd><p>returns the design (event table and several other details) for the simulation, does not run the actual simulation. Useful for iterative functions like estimation in combination with <code><a href="sim_core.html">sim_core()</a></code>, e.g. for estimation and optimal design.</p></dd>


<dt id="arg-output-include">output_include<a class="anchor" aria-label="anchor" href="#arg-output-include"></a></dt>
<dd><p>list specifying what to include in output table, with keys <code>parameters</code> and <code>covariates</code>. Both are FALSE by default.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>extra parameters</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a data frame of compartments with associated concentrations at requested times</p>
<p>Simulated regimen</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="sim_ode_shiny.html">sim_ode_shiny</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  CL <span class="op">=</span> <span class="fl">38.48</span>,</span></span>
<span class="r-in"><span>  V  <span class="op">=</span> <span class="fl">7.4</span>,</span></span>
<span class="r-in"><span>  Q  <span class="op">=</span> <span class="fl">7.844</span>,</span></span>
<span class="r-in"><span>  V2 <span class="op">=</span> <span class="fl">5.19</span>,</span></span>
<span class="r-in"><span>  Q2  <span class="op">=</span> <span class="fl">9.324</span>,</span></span>
<span class="r-in"><span>  V3 <span class="op">=</span> <span class="fl">111</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,       <span class="co"># IIV CL</span></span></span>
<span class="r-in"><span>           <span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span>  <span class="co"># IIV V</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="new_regimen.html">new_regimen</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  amt <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, <span class="fl">36</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  type <span class="op">=</span> <span class="st">"infusion"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="new_ode_model.html">new_ode_model</a></span><span class="op">(</span><span class="st">"pk_3cmt_iv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span></span></span>
<span class="r-in"><span>  ode <span class="op">=</span> <span class="va">mod</span>,</span></span>
<span class="r-in"><span>  parameters <span class="op">=</span> <span class="va">p</span>,</span></span>
<span class="r-in"><span>  omega <span class="op">=</span> <span class="va">omega</span>,</span></span>
<span class="r-in"><span>  n_ind <span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>  regimen <span class="op">=</span> <span class="va">r1</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ron Keizer, Jasmine Hughes, Dominic Tong, Kara Woo, Jordan Brooks, InsightRX.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

