<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Speed • PKPDsim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Speed">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PKPDsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/PKPDsim.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Documentation</h6></li>
    <li><a class="dropdown-item" href="../articles/model.html">Model</a></li>
    <li><a class="dropdown-item" href="../articles/regimen.html">Regimen</a></li>
    <li><a class="dropdown-item" href="../articles/parameters.html">Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/simulation.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/output.html">Output</a></li>
    <li><a class="dropdown-item" href="../articles/variability.html">Variability</a></li>
    <li><a class="dropdown-item" href="../articles/error.html">Residual error</a></li>
    <li><a class="dropdown-item" href="../articles/covariates.html">Covariates</a></li>
    <li><a class="dropdown-item" href="../articles/export-model.html">Export model</a></li>
    <li><a class="dropdown-item" href="../articles/speed.html">Speed</a></li>
    <li><a class="dropdown-item" href="../articles/estimation-nlmixr.html">Estimation: nlmixr2</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>More Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/example-absorption-models.html">Absorption models</a></li>
    <li><a class="dropdown-item" href="../articles/example-pkpd-model.html">PKPD model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/InsightRX/PKPDsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://ds.insight-rx.com/" aria-label="Home"><span class="fa fa-home"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Speed</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/InsightRX/PKPDsim/blob/master/vignettes/speed.Rmd" class="external-link"><code>vignettes/speed.Rmd</code></a></small>
      <div class="d-none name"><code>speed.Rmd</code></div>
    </div>

    
    
<p>The simulation backend in <code>PKPDsim</code> uses an ODE solver
written in C++ (<code>Boost::odeint</code>) to make sure simulations are
fast. Therefore, for most simulation problems computational speed will
not be an issue. Even simulating thousands (or millions) of patients for
complex models will rarely take more than a few minutes. Simpler
simulation problems will commonly take seconds to complete.</p>
<p>However, in some special cases speed could become an issue, and for
that it is important to understand the structure of PKPDsim’s main
function (<code><a href="../reference/sim.html">sim()</a></code>) because. The <code><a href="../reference/sim.html">sim()</a></code> function
is composed of three parts:</p>
<ol style="list-style-type: decimal">
<li>preprocessing (R)</li>
<li>looping over subjects, solving ODE for each subject (R/C++)</li>
<li>post-processing (R)</li>
</ol>
<p>From this structure it is easy to understand that when you would
request simulation of 1,000 patients:</p>
<pre><code><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.html">sim</a></span><span class="op">(</span>ode <span class="op">=</span> <span class="va">mod</span>, <span class="va">....</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre>
<p>the pre- and post-processing parts will take relatively minor
computational time, since the main part will be the loop simulating the
PK for the subjects. However, if instead you would write a loop yourself
to simulate 1,000 patients, and would call <code><a href="../reference/sim.html">sim()</a></code>
repeatedly:</p>
<pre><code><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="../reference/sim.html">sim</a></span><span class="op">(</span>ode <span class="op">=</span> <span class="va">mod</span>, <span class="va">....</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
<p>now in each iteration also the pre- and post-processing functionality
would be invoked, and the overall simulation will take much longer than
before, probably by an order of magnitude. The same concept applies if
you would use <code><a href="../reference/sim.html">sim()</a></code> in the context of population (NLME) or
individual (MAP) estimation, or in optimal design in evaluation of the
FIM.</p>
<p>There is a different way to solve ODEs with <code>PKPDsim</code>
though, which uses only the core ODE solver function and does not
perform pre-/post-processing. If you need to use PKPDsim in an iterative
context as described above, you should therefore use the
<code><a href="../reference/sim_core.html">sim_core()</a></code> function instead, and perform the pre- and
post-processing outside of the main loop, e.g.:</p>
<pre><code><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.html">sim</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="va">mod</span>, <span class="va">....</span>, return_design<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">rbindlist</span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="../reference/sim_core.html">sim_core</a></span><span class="op">(</span>design <span class="op">=</span> <span class="va">design</span>, ode <span class="op">=</span> <span class="va">mod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># potentially any post-processing here</span></span></code></pre>
<div class="section level2">
<h2 id="comparison-with-other-packages">Comparison with other packages<a class="anchor" aria-label="anchor" href="#comparison-with-other-packages"></a>
</h2>
<p>Several other open source R packages provide similar features as
PKPDsim, the main ones being <code>RxODE</code> (now renamed to
<code>rxode2</code>) and <code>mrgsolve</code>.</p>
<p>In the <code>rxode2</code> package, the overhead from pre- and
post-processing is separated from the main simulation function by
default, while <code>mrgsolve</code> is more similar to
<code>PKPDsim</code> with the overhead being included within the main
simulation function. Therefore, especially when used in an iterative
context, <code>RxODE</code> will seem much faster than
<code>PKDPsim</code> and <code>mrgsolve</code>, while
<code>PKPDsim</code> and <code>mrgsolve</code> will seem broadly
similar. However, when using the <code><a href="../reference/sim_core.html">sim_core()</a></code> function as
outlined above, our benchmarks indicate that simulation speed for
<code>PKDDsim</code> is highly similar to that obtained with the
<code>RxODE</code> package.</p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ron Keizer, Jasmine Hughes, Dominic Tong, Kara Woo, Jordan Brooks, InsightRX.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
